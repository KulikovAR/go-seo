# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Kafka –¥–ª—è go-seo

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **KafkaService —Å Sarama**
- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –æ–±—ã—á–Ω–æ–º—É Kafka —á–µ—Ä–µ–∑ Sarama –±–∏–±–ª–∏–æ—Ç–µ–∫—É
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
- Graceful fallback –≤ log-only —Ä–µ–∂–∏–º –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka

### 2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤**
- `tracking-status` - –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–¥–∞—á
- `tracking-jobs` - –¥–ª—è —Å—Ç–∞—Ç—É—Å–æ–≤ –æ—Å–Ω–æ–≤–Ω—ã—Ö –∑–∞–¥–∞—á
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è —Ç–æ–ø–∏–∫–æ–≤ –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º

### 3. **–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
KAFKA_BROKERS=localhost:9092,localhost:9093
```

## üîß –ö–∞–∫ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å

### 1. **–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è**
```bash
# –î–ª—è –æ–¥–Ω–æ–≥–æ –±—Ä–æ–∫–µ—Ä–∞
export KAFKA_BROKERS="localhost:9092"

# –î–ª—è –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –±—Ä–æ–∫–µ—Ä–æ–≤
export KAFKA_BROKERS="localhost:9092,localhost:9093,localhost:9094"

# –î–ª—è Docker (–¥–æ—Å—Ç—É–ø –∫ —Ö–æ—Å—Ç—É)
export KAFKA_BROKERS="host.docker.internal:9092"
```

### 2. **–§–æ—Ä–º–∞—Ç –∞–¥—Ä–µ—Å–æ–≤ –±—Ä–æ–∫–µ—Ä–æ–≤**
```
host:port
```

### 3. **–ü—Ä–∏–º–µ—Ä—ã –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏**

#### –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ Kafka:
```bash
KAFKA_BROKERS=localhost:9092
```

#### –î–ª—è Docker —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ —Ö–æ—Å—Ç—É:
```bash
KAFKA_BROKERS=host.docker.internal:9092
```

#### –î–ª—è –∫–ª–∞—Å—Ç–µ—Ä–∞ Kafka:
```bash
KAFKA_BROKERS=kafka1:9092,kafka2:9092,kafka3:9092
```

#### –î–ª—è –æ—Ç–∫–ª—é—á–µ–Ω–∏—è Kafka (log-only —Ä–µ–∂–∏–º):
```bash
KAFKA_BROKERS=""
```

## üìã –°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å–æ–æ–±—â–µ–Ω–∏–π

### tracking-status —Ç–æ–ø–∏–∫:
```json
{
  "task_id": "task_abc123",
  "job_id": "job_def456", 
  "status": "completed",
  "timestamp": "2024-01-01T12:00:00Z",
  "error": "",
  "result": {
    "keyword_id": 123,
    "site_id": 456,
    "source": "google",
    "rank": 5,
    "url": "https://example.com",
    "title": "Example Title",
    "success": true
  }
}
```

### tracking-jobs —Ç–æ–ø–∏–∫:
```json
{
  "job_id": "job_def456",
  "status": "completed", 
  "error": "",
  "timestamp": "2024-01-01T12:00:00Z"
}
```

## üöÄ –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç

### 1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:**
- –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ Kafka –±—Ä–æ–∫–µ—Ä–∞–º —á–µ—Ä–µ–∑ Sarama
- –°–æ–∑–¥–∞–µ—Ç Producer –∏ Admin –∫–ª–∏–µ–Ω—Ç—ã
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞–µ—Ç —Ç–æ–ø–∏–∫–∏ —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏

### 2. **–ü—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏–π:**
- –ï—Å–ª–∏ Kafka –¥–æ—Å—Ç—É–ø–µ–Ω - –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤ —Ç–æ–ø–∏–∫–∏ —á–µ—Ä–µ–∑ Producer
- –ï—Å–ª–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω - —Ç–æ–ª—å–∫–æ –ª–æ–≥–∏—Ä—É–µ—Ç –≤ –∫–æ–Ω—Å–æ–ª—å

### 3. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫:**
- Graceful degradation –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ Kafka
- –ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π retry –ø—Ä–∏ –≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å–±–æ—è—Ö

## üîç –õ–æ–≥–∏ –∏ –æ—Ç–ª–∞–¥–∫–∞

### –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ:
```
Kafka service initialized with brokers: [localhost:9092]
Topic tracking-status is ready
Topic tracking-jobs is ready
```

### Log-only —Ä–µ–∂–∏–º:
```
Kafka service initialized in log-only mode (no brokers configured)
Kafka message sent (log-only) - TaskID: task_123, JobID: job_456, Status: completed
```

### –û—à–∏–±–∫–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è:
```
Warning: Kafka initialization failed: failed to create producer: dial tcp [::1]:9092: connect: connection refused. Service will work in log-only mode.
```

### –£—Å–ø–µ—à–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ —Å–æ–æ–±—â–µ–Ω–∏–π:
```
Successfully sent message to topic tracking-status, partition 0, offset 123
Successfully sent message to topic tracking-jobs, partition 1, offset 456
```

## üéØ –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ù–∞—Ç–∏–≤–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Kafka** - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç Sarama –±–∏–±–ª–∏–æ—Ç–µ–∫—É
2. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–æ–ø–∏–∫–æ–≤** - –Ω–µ —Ç—Ä–µ–±—É–µ—Ç —Ä—É—á–Ω–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
3. **Graceful degradation** - —Ä–∞–±–æ—Ç–∞–µ—Ç –¥–∞–∂–µ –±–µ–∑ Kafka
4. **–ü—Ä–æ—Å—Ç–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è** - —Ç–æ–ª—å–∫–æ –æ–¥–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è
5. **–ü–æ–¥—Ä–æ–±–Ω—ã–µ –ª–æ–≥–∏** - –ª–µ–≥–∫–æ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å –ø—Ä–æ–±–ª–µ–º—ã
6. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏** - compression, retention, partitions

## üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ç–æ–ø–∏–∫–æ–≤

–¢–æ–ø–∏–∫–∏ —Å–æ–∑–¥–∞—é—Ç—Å—è —Å –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏:
- **Partitions:** 3 (–¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏)
- **Replication Factor:** 1 (–¥–ª—è single-node –∫–ª–∞—Å—Ç–µ—Ä–∞)
- **Retention:** 7 –¥–Ω–µ–π (604800000 –º—Å)
- **Cleanup Policy:** delete (—É–¥–∞–ª–µ–Ω–∏–µ —Å—Ç–∞—Ä—ã—Ö —Å–æ–æ–±—â–µ–Ω–∏–π)
- **Compression:** snappy (—Å–∂–∞—Ç–∏–µ –¥–ª—è —ç–∫–æ–Ω–æ–º–∏–∏ –º–µ—Å—Ç–∞)

## üîß Docker –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –î–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ Kafka –Ω–∞ —Ö–æ—Å—Ç–µ:
```bash
# –í docker-compose.yml –∏–ª–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ
KAFKA_BROKERS=host.docker.internal:9092
```

### –î–ª—è Kafka –≤ Docker —Å–µ—Ç–∏:
```bash
KAFKA_BROKERS=kafka:9092
```
