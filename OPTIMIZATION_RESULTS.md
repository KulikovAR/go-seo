# –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞ - –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

## ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –±–∞—Ç—á–∞**

**–ü—Ä–æ–±–ª–µ–º–∞:** –ë–∞—Ç—á–∏ —Å–æ–∑–¥–∞–≤–∞–ª–∏—Å—å –ø–æ 1 –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É –Ω–µ–∑–∞–≤–∏—Å–∏–º–æ –æ—Ç –Ω–∞—Å—Ç—Ä–æ–µ–∫ BATCH_SIZE.

**–†–µ—à–µ–Ω–∏–µ:** 
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `calculateOptimalBatchSize()` 
- –†–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ —Ç–µ–ø–µ—Ä—å —Ä–∞—Å—Å—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ:
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∑–∞–¥–∞—á
  - –ö–æ–ª–∏—á–µ—Å—Ç–≤–∞ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö worker'–æ–≤
  - –ú–∞–∫—Å–∏–º–∞–ª—å–Ω–æ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –∏–∑ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**–õ–æ–≥–∏–∫–∞ —Ä–∞—Å—á–µ—Ç–∞:**
```go
// –ï—Å–ª–∏ –∑–∞–¥–∞—á –º–µ–Ω—å—à–µ —á–µ–º worker'–æ–≤ - –±–∞—Ç—á–∏ –ø–æ 1
if totalTasks <= workerCount {
    return 1
}

// –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä = –æ–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ / –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ worker'–æ–≤
optimalBatchSize := totalTasks / workerCount

// –û–≥—Ä–∞–Ω–∏—á–∏–≤–∞–µ–º –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–º (1) –∏ –º–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–º (–∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞) –∑–Ω–∞—á–µ–Ω–∏—è–º–∏
```

### 2. **–£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î**

**–ü—Ä–æ–±–ª–µ–º–∞:** –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∫–ª—é—á–µ–≤–æ–≥–æ —Å–ª–æ–≤–∞ –≤—ã–ø–æ–ª–Ω—è–ª–∏—Å—å –æ—Ç–¥–µ–ª—å–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:
- 11 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å–∞–π—Ç–∞ (–æ–¥–∏–Ω–∞–∫–æ–≤—ã–π!)
- 11 –∑–∞–ø—Ä–æ—Å–æ–≤ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤

**–†–µ—à–µ–Ω–∏–µ:**
- –°–æ–∑–¥–∞–Ω–∞ —Ñ—É–Ω–∫—Ü–∏—è `processBatch()` —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö
- –î–∞–Ω–Ω—ã–µ —Å–∞–π—Ç–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **1 —Ä–∞–∑** –¥–ª—è –≤—Å–µ–≥–æ –±–∞—Ç—á–∞
- –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è **1 –∑–∞–ø—Ä–æ—Å–æ–º** –¥–ª—è –≤—Å–µ–≥–æ –±–∞—Ç—á–∞
- –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `GetByIDs()` –≤ KeywordRepository

**–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
```go
// –°—Ç–∞—Ä—ã–π –ø–æ–¥—Ö–æ–¥ (11 –∑–∞–ø—Ä–æ—Å–æ–≤):
for _, task := range tasks {
    site := uc.siteRepo.GetByID(task.SiteID)     // 11 –∑–∞–ø—Ä–æ—Å–æ–≤
    keyword := uc.keywordRepo.GetByID(task.KeywordID) // 11 –∑–∞–ø—Ä–æ—Å–æ–≤
    uc.executeTask(task)
}

// –ù–æ–≤—ã–π –ø–æ–¥—Ö–æ–¥ (2 –∑–∞–ø—Ä–æ—Å–∞):
site := uc.siteRepo.GetByID(siteID)                    // 1 –∑–∞–ø—Ä–æ—Å
keywords := uc.keywordRepo.GetByIDs(keywordIDs)        // 1 –∑–∞–ø—Ä–æ—Å
for _, task := range tasks {
    uc.executeTaskWithData(task, site, keywordMap[task.KeywordID])
}
```

### 3. **–û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è**

**–î–æ–±–∞–≤–ª–µ–Ω—ã –Ω–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:**
- `executeGoogleTaskWithData()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
- `executeYandexTaskWithData()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ  
- `executeWordstatTaskWithData()` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —É–∂–µ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

**–°–æ—Ö—Ä–∞–Ω–µ–Ω—ã —Å—Ç–∞—Ä—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏** –¥–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏:
- `executeGoogleTask()` - –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á
- `executeYandexTask()` - –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á
- `executeWordstatTask()` - –¥–ª—è –æ–¥–∏–Ω–æ—á–Ω—ã—Ö –∑–∞–¥–∞—á

## üìä –û–∂–∏–¥–∞–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### –î–æ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ (–∏–∑ –ª–æ–≥–æ–≤):
- **11 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ Google:** 34 —Å–µ–∫—É–Ω–¥—ã
- **11 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ Yandex:** 24 —Å–µ–∫—É–Ω–¥—ã
- **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:** 22+ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–∞–π—Ç + 22+ –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
- **–ë–∞—Ç—á–∏:** –ø–æ 1 –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É (–Ω–µ—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ)

### –ü–æ—Å–ª–µ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏:
- **11 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤:** 8-12 —Å–µ–∫—É–Ω–¥ (–≤ 3-4 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ)
- **–ó–∞–ø—Ä–æ—Å–æ–≤ –∫ –ë–î:** 2 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ —Å–∞–π—Ç + 2 –∑–∞–ø—Ä–æ—Å–∞ –Ω–∞ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
- **–ë–∞—Ç—á–∏:** –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä (–Ω–∞–ø—Ä–∏–º–µ—Ä, 3-4 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤–∞ –¥–ª—è 11 –∑–∞–¥–∞—á)

## üéØ –ü—Ä–∏–º–µ—Ä—ã —Ä–∞–±–æ—Ç—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –±–∞—Ç—á–∏–Ω–≥–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: 11 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, 20 worker'–æ–≤
```
–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ = 11 / 20 = 0.55 ‚Üí 1
–†–µ–∑—É–ª—å—Ç–∞—Ç: 11 –±–∞—Ç—á–µ–π –ø–æ 1 –∫–ª—é—á–µ–≤–æ–º—É —Å–ª–æ–≤—É
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 2: 100 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, 20 worker'–æ–≤  
```
–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ = 100 / 20 = 5
–†–µ–∑—É–ª—å—Ç–∞—Ç: 20 –±–∞—Ç—á–µ–π –ø–æ 5 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 3: 1000 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, 20 worker'–æ–≤
```
–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ = 1000 / 20 = 50
–†–µ–∑—É–ª—å—Ç–∞—Ç: 20 –±–∞—Ç—á–µ–π –ø–æ 50 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
```

### –°—Ü–µ–Ω–∞—Ä–∏–π 4: 2000 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤, 20 worker'–æ–≤, BATCH_SIZE=100
```
–û–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞ = 2000 / 20 = 100
–û–≥—Ä–∞–Ω–∏—á–µ–Ω–æ BATCH_SIZE=100
–†–µ–∑—É–ª—å—Ç–∞—Ç: 20 –±–∞—Ç—á–µ–π –ø–æ 100 –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
```

## üîß –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ù–æ–≤—ã–µ –º–µ—Ç–æ–¥—ã –≤ KeywordRepository:
```go
GetByIDs(ids []int) ([]*entities.Keyword, error)
```

### –ù–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ AsyncPositionTrackingUseCase:
```go
calculateOptimalBatchSize(totalTasks int) int
processBatch(batchTasks []*entities.TrackingTask)
processTaskWithData(task, site, keyword)
executeTaskWithData(task, site, keyword)
executeGoogleTaskWithData(task, site, keyword)
executeYandexTaskWithData(task, site, keyword)  
executeWordstatTaskWithData(task, site, keyword)
```

## üöÄ –†–µ–∑—É–ª—å—Ç–∞—Ç

–°–∏—Å—Ç–µ–º–∞ —Ç–µ–ø–µ—Ä—å:
1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç** –æ–ø—Ç–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä –±–∞—Ç—á–∞
2. **–ú–∏–Ω–∏–º–∏–∑–∏—Ä—É–µ—Ç –∑–∞–ø—Ä–æ—Å—ã** –∫ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö
3. **–ò—Å–ø–æ–ª—å–∑—É–µ—Ç worker pool** —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ
4. **–û–±—Ä–∞—Ç–Ω–æ —Å–æ–≤–º–µ—Å—Ç–∏–º–∞** —Å–æ —Å—Ç–∞—Ä—ã–º –∫–æ–¥–æ–º
5. **–ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ—Ç—Å—è** –¥–ª—è –ª—é–±–æ–≥–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤

**–û–∂–∏–¥–∞–µ–º—ã–π –ø—Ä–∏—Ä–æ—Å—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏: 3-4 —Ä–∞–∑–∞ –±—ã—Å—Ç—Ä–µ–µ!** üéâ
